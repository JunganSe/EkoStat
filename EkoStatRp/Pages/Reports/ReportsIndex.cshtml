@page "/Reports"
@model EkoStatRp.Pages.Reports.ReportsIndex
@{
    ViewData["Title"] = "Reports";
    var earliestTimestamp = new DateTime();
    var latestTimestamp = new DateTime();
    double days = 0;
    double weeks = 0;
    double months = 0;
    double years = 0;
    int entriesCount = Model.EntryGroups.Sum(eg => eg.Entries.Count);
    if (entriesCount > 0)
    {
        earliestTimestamp = Model.EntryGroups.SelectMany(eg => eg.Entries).Select(e => e.Timestamp).Min();
        latestTimestamp = Model.EntryGroups.SelectMany(eg => eg.Entries).Select(e => e.Timestamp).Max();
        var timeSpan = latestTimestamp - earliestTimestamp;
        days = timeSpan.TotalDays;
        weeks = Math.Round(days / 7, 2);
        months = Math.Round(days / 30.44, 2);
        years = Math.Round(days / 365.25, 2);
    }
    var totalCost = Model.EntryGroups.Sum(eg => eg.TotalCost);
}

<h1>Reports</h1>
<a asp-page="@Constants.RazorPages.ReportsSaved">Saved reports</a>
<hr />

<h2>Filter</h2>
<partial name="@Constants.PartialViews.FilterEntries" model="@Model.FilterViewModel" />

@if (entriesCount > 0)
{
    <hr />
    <h2>Summary</h2>
    <p>
        Showing @Model.EntryGroups.Count articles from @entriesCount entries <br />
        from @earliestTimestamp until @latestTimestamp <br />
        which is @days days, or @weeks weeks, or about @months months, or about @years years <br />
        with a total cost of @totalCost
    </p>

    <hr />
    <h2>Articles</h2>
    <partial name="@Constants.PartialViews.EntriesGroupedByArticle" model="@Model.EntryGroups" />
}
